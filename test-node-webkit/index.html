<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>hello world</title>
  <link rel="stylesheet" href="style.css">
</head>
<body onload="/*process.mainModule.exports.callback();*/">
  <div class="toolbar" id="toolbar"></div>
  <ul class="system_mutual">
    <li class="refresh2" title="强制刷新"><i></i></li>
    <li class="refresh" title="刷新"><i></i></li>
    <li class="minimum" id="minimum" title="最小化"></li>
    <li class="maximum" id='maximum' title="最大化"></li>
    <li id="close" class="close" title="关闭"></li>
  </ul>
  <div class="wraper" id="devtools">
    <h1>Hello World!0</h1>
    <input type="button" value="截图" onclick = "oMenu.takeSnapshot('images/','aa','png')">
  </div>
  <script>
var oMenu = {
  "isMaxScreen":false,
  "getOne":function(p,str){
    return p.querySelector(str);
  },
  "getAll":function(p,str){
    return p.querySelectorAll(str);
  },
  "minFn":function(){
    win.hide();
    var tray = new gui.Tray({title:"tray",icon:"logo.png"});
    tray.tooltip = "打开软件";
    tray.on("click",function(){
      this.remove();
      tray = null;
      win.show();
      win.focus();
      isShowWindow = true;
    });
  },
  "maxFn":function(){
    if(!oMenu.isMaxScreen){
      win.maximize();
    }else{
      win.unmaximize();
    }
    oMenu.isMaxScreen = !oMenu.isMaxScreen;
  },
  // 截图函数
  takeSnapshot:function(path,name,type){
    win.capturePage(function (img) {
      var base64Data = img.replace(/^data:image\/(png|jpg|jpeg);base64,/, "");
      require("fs").writeFile(path+name+"."+type, base64Data, 'base64', function (err) {
       console.log(err);
      });
    }, type);
  }
}

//获取当前窗口
var gui = require("nw.gui"),
  win = gui.Window.get();

var oMinimum = oMenu.getOne(document,".minimum"),
  oMaximum = oMenu.getOne(document,".maximum"),
  oClose = oMenu.getOne(document,".close"),
  oRefreah = oMenu.getOne(document,".refresh"),
  oRefreah2 = oMenu.getOne(document,".refresh2"),
  h1 = oMenu.getOne(document,"h1");

// 刷新窗口
oRefreah.addEventListener("click",function(){
  win.reload();
});

// 强刷
oRefreah2.addEventListener("click",function(){
  win.reloadIgnoringCache();
});

//窗口最小化
oMinimum.addEventListener("click",function(){
  win.minimize();
});
// 侦听窗口最小化
win.on("minimize",oMenu.minFn);

//窗口最大化
oMaximum.addEventListener("click",oMenu.maxFn);

// 关闭窗口
oClose.addEventListener("click",function(){
  win.close();
});

//创建菜单
// 创建window菜单
var topMenubar = new gui.Menu({ type: 'menubar' });
var rightHand = new gui.Menu();
rightHand.append(new gui.MenuItem({
  label:"复制",
  //type:"checkbox",
  icon:"logo.png",
  click:function(){
    alert("逗你呢");
  }
}));
topMenubar.append(new gui.MenuItem({label:"菜单哈",submenu:rightHand}));
win.menu = topMenubar;
// 创建content菜单

document.addEventListener("contextmenu",function(ev){
  ev.preventDefault();
  rightHand.popup(ev.clientX,ev.clientY);
  return false;
});




  </script>
</body>
</html>